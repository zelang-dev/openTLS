<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   $OpenBSD: tls_init.3,v 1.13 2018/07/09 19:47:20 tb Exp $
  
   Copyright (c) 2014 Ted Unangst <tedu@openbsd.org>
   Copyright (c) 2016 Joel Sing <jsing@openbsd.org>
   Copyright (c) 2017 Ingo Schwarze <schwarze@openbsd.org>
  
   Permission to use, copy, modify, and distribute this software for any
   purpose with or without fee is hereby granted, provided that the above
   copyright notice and this permission notice appear in all copies.
  
   THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
   WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
   MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
   ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
   WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
   ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
   OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
   -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>TLS_INIT(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">TLS_INIT(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">TLS_INIT(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">tls_init</code>,
    <code class="Nm">tls_config_new</code>,
    <code class="Nm">tls_config_free</code>,
    <code class="Nm">tls_config_error</code> &#x2014;
    <span class="Nd">initialize TLS client and server API</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><code class="In">#include
  &lt;<a class="In">tls.h</a>&gt;</code></p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">tls_init</code>(<var class="Fa" style="white-space: nowrap;">void</var>);</p>
<p class="Pp"><var class="Ft">struct tls_config *</var>
  <br/>
  <code class="Fn">tls_config_new</code>(<var class="Fa" style="white-space: nowrap;">void</var>);</p>
<p class="Pp"><var class="Ft">void</var>
  <br/>
  <code class="Fn">tls_config_free</code>(<var class="Fa" style="white-space: nowrap;">struct
    tls_config *config</var>);</p>
<p class="Pp"><var class="Ft">const char *</var>
  <br/>
  <code class="Fn">tls_config_error</code>(<var class="Fa" style="white-space: nowrap;">struct
    tls_config *config</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The <code class="Nm">tls</code> family of functions establishes a
    secure communications channel using the TLS socket protocol. Both clients
    and servers are supported.</p>
<p class="Pp" id="tls_init">The
    <a class="permalink" href="#tls_init"><code class="Fn">tls_init</code></a>()
    function initializes global data structures. It is no longer necessary to
    call this function directly, since it is invoked internally when needed. It
    may be called more than once, and may be called concurrently.</p>
<p class="Pp" id="tls_config_new">Before a connection is created, a
    configuration must be created. The
    <a class="permalink" href="#tls_config_new"><code class="Fn">tls_config_new</code></a>()
    function allocates, initializes, and returns a new default configuration
    object that can be used for future connections. Several functions exist to
    change the options of the configuration; see
    <a class="Xr">tls_config_set_protocols(3)</a>,
    <a class="Xr">tls_load_file(3)</a>,
    <a class="Xr">tls_config_ocsp_require_stapling(3)</a>, and
    <a class="Xr">tls_config_verify(3)</a>.</p>
<p class="Pp" id="tls_config_error">The
    <a class="permalink" href="#tls_config_error"><code class="Fn">tls_config_error</code></a>()
    function may be used to retrieve a string containing more information about
    the most recent error relating to a configuration.</p>
<p class="Pp">A TLS connection object is created by
    <a class="Xr">tls_client(3)</a> or <a class="Xr">tls_server(3)</a> and
    configured with <a class="Xr">tls_configure(3)</a>.</p>
<p class="Pp">A client connection is initiated after configuration by calling
    <a class="Xr">tls_connect(3)</a>. A server can accept a new client
    connection by calling <a class="Xr">tls_accept_socket(3)</a> on an already
    established socket connection.</p>
<p class="Pp">Two functions are provided for input and output,
    <a class="Xr">tls_read(3)</a> and <a class="Xr">tls_write(3)</a>. Both
    automatically perform the <a class="Xr">tls_handshake(3)</a> when
  needed.</p>
<p class="Pp">The properties of established TLS connections can be inspected
    with the functions described in <a class="Xr">tls_conn_version(3)</a> and
    <a class="Xr">tls_ocsp_process_response(3)</a>.</p>
<p class="Pp">After use, a TLS connection should be closed with
    <a class="Xr">tls_close(3)</a> and then freed by calling
    <a class="Xr">tls_free(3)</a>.</p>
<p class="Pp" id="tls_config_free">When no more contexts are to be configured,
    the configuration object should be freed by calling
    <a class="permalink" href="#tls_config_free"><code class="Fn">tls_config_free</code></a>().
    It is safe to call <code class="Fn">tls_config_free</code>() as soon as the
    final call to
    <a class="permalink" href="#tls_configure"><code class="Fn" id="tls_configure">tls_configure</code></a>()
    has been made. If <var class="Fa">config</var> is
    <code class="Dv">NULL</code>, no action occurs.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUES"><a class="permalink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
<p class="Pp"><code class="Fn">tls_init</code>() returns 0 on success or -1 on
    error.</p>
<p class="Pp"><code class="Fn">tls_config_new</code>() returns
    <code class="Dv">NULL</code> on error or an out of memory condition.</p>
<p class="Pp"><code class="Fn">tls_config_error</code>() returns
    <code class="Dv">NULL</code> if no error occurred with
    <var class="Fa">config</var> at all, or if memory allocation failed while
    trying to assemble the string describing the most recent error related to
    <var class="Fa">config</var>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr">tls_accept_socket(3)</a>,
    <a class="Xr">tls_client(3)</a>,
    <a class="Xr">tls_config_ocsp_require_stapling(3)</a>,
    <a class="Xr">tls_config_set_protocols(3)</a>,
    <a class="Xr">tls_config_verify(3)</a>,
    <a class="Xr">tls_conn_version(3)</a>, <a class="Xr">tls_connect(3)</a>,
    <a class="Xr">tls_load_file(3)</a>,
    <a class="Xr">tls_ocsp_process_response(3)</a>,
    <a class="Xr">tls_read(3)</a></p>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
<p class="Pp">The <code class="Nm">tls</code> API first appeared in
    <span class="Ux">OpenBSD 5.6</span> as a response to the unnecessary
    challenges other APIs present in order to use them safely.</p>
<p class="Pp">All functions were renamed from <code class="Fn">ressl_*</code>()
    to <code class="Fn">tls_*</code>() for <span class="Ux">OpenBSD
  5.7</span>.</p>
<p class="Pp"><code class="Fn">tls_config_error</code>() appeared in
    <span class="Ux">OpenBSD 6.0</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<p class="Pp"><span class="An">Joel Sing</span>
    &lt;<a class="Mt" href="mailto:jsing@openbsd.org">jsing@openbsd.org</a>&gt;
  <br/>
  <span class="An">Ted Unangst</span>
    &lt;<a class="Mt" href="mailto:tedu@openbsd.org">tedu@openbsd.org</a>&gt;</p>
<p class="Pp">Many others contributed to various parts of the library; see the
    individual manual pages for more information.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CAVEATS"><a class="permalink" href="#CAVEATS">CAVEATS</a></h1>
<p class="Pp">The function <code class="Fn">tls_config_error</code>() returns an
    internal pointer. It must not be freed by the application, or a double free
    error will occur. The pointer will become invalid when the next error occurs
    with <var class="Fa">config</var>. Consequently, if the application may need
    the message at a later time, it has to copy the string before calling the
    next
    <a class="permalink" href="#libtls"><b class="Sy" id="libtls">libtls</b></a>
    function involving <var class="Fa">config</var>, or a segmentation fault or
    read access to unintended data is the likely result.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">July 9, 2018</td>
    <td class="foot-os">Debian</td>
  </tr>
</table>
</body>
</html>
